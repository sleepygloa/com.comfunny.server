create table posts (
 id bigint not null auto_increment,
 created_date datetime,
 modified_date datetime,
 author varchar(255),
 content TEXT not null,
 title varchar(500) not null,
 primary key (id)
) engine=InnoDB;

create table user (
 id bigint not null auto_increment,
 created_date datetime,
 modified_date datetime, email varchar(255) not null,
 name varchar(255) not null,
 picture varchar(255),
 role varchar(255) not null,
 primary key (id)
 ) engine=InnoDB;
/*
* 스프링 세션 테이블은 -> schema-mysql.sql 에서 확인 가능합니다.
* File 검색(win: Ctrl+Shift+N)으로 검색
*/


CREATE TABLE SPRING_SESSION(
	PRIMARY_ID CHAR(36) NOT NULL,
	SESSION_ID CHAR(36) NOT NULL,
	CREATION_TIME BIGINT NOT NULL,
	LAST_ACCESS_TIME BIGINT NOT NULL,
	MAX_INACTIVE_INTERVAL INT NOT NULL,
	EXPIRY_TIME BIGINT NOT NULL,
	PRINCIPAL_NAME VARCHAR(100),
	CONSTRAINT SPRING_SESSION_PK PRIMARY KEY (PRIMARY_ID)
) ENGINE=INNODB ROW_FORMAT=DYNAMIC;

CREATE UNIQUE INDEX SPRING_SESSION_IX1 ON SPRING_SESSION (SESSION_ID);
CREATE UNIQUE INDEX SPRING_SESSION_IX2 ON SPRING_SESSION (EXPIRY_TIME);
CREATE UNIQUE INDEX SPRING_SESSION_IX3 ON SPRING_SESSION (PRINCIPAL_NAME);

CREATE TABLE SPRING_SESSION_ATTRIBUTES(
	SESSION_PRIMARY_ID CHAR(36) NOT NULL,
	ATTRIBUTE_NAME VARCHAR(200) NOT NULL,
	ATTRIBUTE_BYTES BLOB NOT NULL,
	CONSTRAINT SPRING_SESSION_ATTRIBUTES_PK PRIMARY KEY (SESSION_PRIMARY_ID, ATTRIBUTE_NAME),
	CONSTRAINT SPRING_SESSION_ATTRIBUTES_FK FOREIGN KEY (SESSION_PRIMARY_ID) REFERENCES SPRING_SESSION(PRIMARY_ID) ON DELETE CASCADE
) ENGINE=InnoDB ROW_FORMAT=DYNAMIC;


CREATE TABLE IF NOT EXISTS `menu` (
  `MENU_SEQ` int DEFAULT NULL,
  `MENU_PARENT_SEQ` int DEFAULT NULL,
  `MENU_LEV` int DEFAULT NULL,
  `MENU_CD` varchar(20) DEFAULT NULL,
  `MENU_NM` varchar(100) DEFAULT NULL,
  `MENU_ICON` varchar(100) DEFAULT NULL,
  `MENU_ORDER` varchar(100) DEFAULT NULL,
  `DEVICE_FLAG` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'A',
  `USE_YN` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'Y',
  `DEL_YN` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'N',
  `IN_USER_ID` varchar(100) DEFAULT NULL,
  `UP_USER_ID` varchar(100) DEFAULT NULL,
  `created_date` datetime DEFAULT NULL,
  `modified_date` datetime DEFAULT NULL,
  KEY `인덱스 1` (`MENU_SEQ`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='메뉴관리';




drop table if exists user_authority CASCADE ;

drop table if exists authority CASCADE ;

drop table if exists proj.user CASCADE ;



    create table authority (
       authority_name VARCHAR(50) not null,
        primary key (authority_name)
    );

    create table proj.user (
       user_id int not null auto_increment,
        activated boolean,
        nickname VARCHAR(50),
        password VARCHAR(100),
        username VARCHAR(50),
        primary key (user_id)
    );

    create table user_authority (
       user_id int not null,
        authority_name varchar(50) not null,
        primary key (user_id, authority_name)
    );


    alter table proj.user
       add constraint UK_sb8bbouer5wak8vyiiy4pf2bx unique (username);


    alter table user_authority
       add constraint FK6ktglpl5mjosa283rvken2py5
       foreign key (authority_name)
       references authority(authority_name);


    alter table user_authority
       add constraint FKpqlsjpkybgos9w2svcri7j8xy
       foreign key (user_id)
       references proj.user(user_id);


INSERT INTO proj.user (user_id, username, password , nickname, activated) VALUES (1, 'admin', '$2a$08$lDnHPz7eUkSi6ao14Twuau08mzhWrL4kyZGGU5xfiGALO/Vxd5DOi', 'admin', 1);
INSERT INTO proj.user  (user_id, username, password, nickname, activated) VALUES (2, 'user', '$2a$08$UkVvwpULis18S19S5pZFn.YHPZt3oaqHZnDwqbCW9pft6uFtkXKDC', 'user', 1);

INSERT INTO proj.authority (authority_name) values ('ROLE_USER');
INSERT INTO proj.authority (authority_name) values ('ROLE_ADMIN');

INSERT INTO proj.user_authority (user_id, authority_name) values (1, 'ROLE_USER');
INSERT INTO proj.user_authority (user_id, authority_name) values (1, 'ROLE_ADMIN');
INSERT INTO proj.user_authority (user_id, authority_name) values (2, 'ROLE_USER');
